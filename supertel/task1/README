// UTF-8, 0a

    Сеть двухранговая. Ведущий всегда один. Все остальные --- ведомые.
    Между ведомыми --- одноранговая связь. При пропадании ведущего ведомые
    должны выбрать себе нового ведущего. Для этого программа ведущего
    реплицируется в каждом ведомом.

    Прежде всего, нужно определить, что значит фраза "ведущий пропал".
    Контрольные пакеты от ведущего поступают с постоянной периодичностью.
    Признак пропажи ведущего --- отсутствие контрольного пакета в течение
    некоторого (длительного) промежутка времени.
    Длительный промежуток времени --- величина назначаемая. Например,
    две длительности интервалов посылки контрольных пактов.

    После обнаружения пропажи ведущего любой ведомый инициирует выборы нового
    ведущего. Проводится голосование. Но каждый голосует только за самого себя.
    Голос --- число. Чей голос больше, тот и ведущий. Голосование может
    проводиться в несколько туров. Новый тур имеет место только если в
    предыдущем выявилось несколько наибольших голосов.

    Иницировать голосование может любой ведомый. Это действие состоит в отправке
    пакета со своим голосом. Все остальные на этот голос отвечают своим голосом.
    Каждый тур длится фиксированное время (полагая, что сеть надежная в плане
    качества связи). К концу тура все получили голоса ото всех и каждый
    принимает решение о небходимости нового тура. Ведомый не отправляет своего
    голоса, если он заведомо не превышает голоса принятого.

    Ожидание контрольного пакета от ведущего ведомый начинает сразу после того,
    как перестает участвовать в голосовании.

    Теперь, после выбора нового ведущего и некоторой работы в таком режиме
    вдруг объявляется штатный ведущий. Его действие при каждом включении ---
    сброс текущего ведущего. Это отдельный пакет, отправляемый лишь штатным
    ведущим.

    При получении пакета сброса ведущего все ведомые прекращают процедуру
    голосования. При получении пакета с голосом штатный ведущий отправляет пакет
    сброса ведущего.


    Для реализации такой работы использоваться будет протокол UDP.
    Контрольные пакеты от ведущего отправляются всем (broadcast).
    Ведомые шлют ответы на контрольный пакет адресно.

    Использование широковещания накладывает свои ограничения на построение сети.
    Для более сложной сети нужно будет использовать multicast.

    Сброс ведущего также отправляется всем.
    Пакеты с голосом отправляются всем.

    Информационные пакеты отправляются всем либо адресно.


    Для реализации в виде однопоточного приложения можно использовать механизмы
    опроса epoll/poll/select.


    Структура пакета:
    сдвиг   длина   значение
      0       1     сигнатура (тип пакета)
      1      ...    тело пакета (структура зависит от типа)

    Контрольный пакет (ведущий -> ведомый):
        тело --- пустое.

    Ответ на контрольный пакет (ведомый -> ведущий):
    сдвиг   длина   значение
      1       1     температура (знаковая)
      2       1     освещенность

    Информационный пакет (ведущий -> ведомый):
    сдвиг   длина   значение
      1       5     текстовое представление средней температуры, '\0'
      6       1     средняя температура (знаковая)
      7       4     дата и время (от 1-го января 1970 г.)
      11      1     яркость

    Голос:
    сдвиг   длина   значение
      1       4     голос

    Сброс ведущего:
        тело --- пустое

    Программы ведущего и ведомого привязываются к сетевым интерфейсам.
    У запускающего их пользователя должно быть достаточно для этого прав.
